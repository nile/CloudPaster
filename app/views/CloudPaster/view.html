#{extends 'table.html'/}
#{set title:paster.title/}
#{if flash.error}
<div class="warning">
  <p>${flash.error}</p>
</div>
#{/if}

<h2>${paster.title}</h2>
<table style="width:100%">
  <tr><td>
      ${paster.content.raw()}
  </td></tr>
  <tr><td>
      <table style="width:100%">
        <tr><td style="padding-left:20px;">
	    #{tags paster:paster/}
	    <span class="info">
            ${paster.creator.name} ${paster.created.freindly()} 提问
            #{if paster.updated} &nbsp; ${paster.lastUser.name} ${paster.updated.freindly()} 修改#{/if}
	    </span>
          </td><td class="right">
	    #{voteactions user:user,paster:paster/}
	    <div class="post-actions">
            #{a @CloudPaster.edit(paster.id)}编辑#{/a}
            &nbsp;#{a @CloudPaster.answer(paster.id)}回答#{/a}
            &nbsp;#{a @CloudPaster.comment(paster.id)}评论#{/a}
	    </div>
      </td></tr></table>
  </td></tr>
  #{if paster.comments.size>0}
  <tr><td>
      <table>
        #{list items:paster.comments,as:'comment'}
        <tr><td style="width:5%">&nbsp;</td>
          <td style="color:#828282;font-size:75%;padding-left:20px;">${comment.content.raw()} ${comment.creator.name} ${comment.created.freindly()} 评论。
        </td></tr>
        #{/list}
      </table>
  </td></tr>
  #{/if}
  #{if state=="question-edit"}
  <tr><td>
      #{form @CloudPaster.ask()}
      <input type="hidden" name="id" value="${paster.id}"/>
      <table class="bg1">
        <tr><td><h2>编辑问题</h2></td></tr>
        <tr><td><input id="paster-title" type="text" name="title" value="${paster.title}" style="width:300px;"/></td></tr>
        <tr><td>#{editor id:"paster-content",name:"content",value:paster.wiki,type:'wiki'/}</td></tr>
        <tr><td><input id="paster-tags" name="tagstext" value="${paster.tagstext}" style="width:200px;"/></td></tr>
        <tr><td><input type="submit" name="doupdatequestion" value="保存"/>
            <input type="submit" name="docancel" value="取消" onclick="javascript:location.href='@{CloudPaster.view(paster.id)}';return false;"/></td></tr>
      </table>
      #{/form}
  </td></tr>
  #{/if}
  
  #{if state=='answer'}
  <tr><td>
      #{form @CloudPaster.answer(paster.id)}
      <table class="bg1">
        <tr><td><h2>你的回复</h2></td></tr>
        <tr><td>#{editor id:'answer-editor',name:'content',type:'wiki'/}</td></tr>
        <tr><td><input type="submit" name="doansweradd" value="新回复"></input>	
            <input type="submit" name="docancel" value="取消"></input></td></tr>
      </table>
      #{/form}
  </td></tr>
  #{/if}
  
  #{if state=='comment'}
  <tr><td>
      #{form @CloudPaster.comment(paster.id)}
      <table class="center bg1"><tr><td><h2>你对该问题的评论:</h2></td></tr>
        <tr><td>#{editor id:'answer-editor',name:'content',mode:'simple'/}</td></tr>
        <tr><td><input type="submit" name="docommentadd" value="新评论"></input>
            <input type="submit" name="docancel" value="取消"></input></td></tr>
      </table>
      #{/form}
  </td></tr>
  #{/if}
  
  <tr><td>
      <h2>${paster.answerCount}个回答</h2>
  </td></tr>
  
  <tr><td>
      #{list items:paster.answers,as:'answer'}
      <table>
        <tr><td>${answer.content.raw()}</td></tr>
        <tr><td>
            <table ><tr><td style="width:70%;color:#828282;font-size:75%;padding-left:20px;">
                  ${answer.creator.name} ${answer.created.freindly()} 回答
		  #{if answer.updated} &nbsp; ${answer.lastUser.name} ${answer.updated.freindly()}修改#{/if} 
                </td><td class="right">
		  #{voteactions user:user,paster:answer/}
		  <div class="post-actions">
                    #{a @CloudPaster.edit(answer.id)}编辑#{/a}
                    #{a @CloudPaster.comment(paster.id,answer.id)}评论#{/a}
		  </div>
            </td></tr></table>
        </td></tr>
        #{if answer.comments.size>0}
        <tr><td>
            <table>
              #{list items:answer.comments,as:'comment'}
              <tr><td style="width:5%">&nbsp;</td>
                <td style="color:#828282;font-size:75%;padding-left:20px;"><span style="color:#0f0f0f">${comment.content.raw()}</span>
                  ${comment?.creator?.name} ${comment.created.freindly()} 评论。
              </td></tr>
              #{/list}
            </table>
        </td></tr>
        #{/if}
        #{if state=='answer-edit' && answer.id == id}
        <tr><td>
            #{form @CloudPaster.answer(paster.id,answer.id)}
            <table class="bg1">
              <tr><td><h2>编辑回答</h2></td></tr>
              <tr><td>#{editor id:'answer-editor',name:'content',type:'wiki',value:answer.wiki/}</td></tr>
              <tr><td><input type="submit" name="doupdateanswer" value="保存"></input>
                  <input type="submit" name="docancel" value="取消" onclidk="javascript:location.href='@{CloudPaster.view(paster.id)}';return false;"></input>
              </td></tr>
            </table>
            #{/form}
        </td></tr>
        #{/if}
        
        #{if state=='answer-comment' && aid==answer.id}
        <tr><td>
            #{form @CloudPaster.comment()}
            #{hidden name:'id',value:paster.id/}
            #{hidden name:'aid',value:answer.id/}
            <table class="center bg1"><tr><td><h2>你对该回答的评论:</h2></td></tr>
              <tr><td>#{editor id:'answer-editor',name:'content',mode:'simple'/}</td></tr>
              <tr><td><input type="submit" name="docommentadd" value="新评论"></input>
                  <input type="submit" name="docancel" value="取消"></input></td></tr>
            </table>
            #{/form}
        </td></tr>
        #{/if}
      </table>
      #{/list}
      
  </td></tr>
  
</table>




